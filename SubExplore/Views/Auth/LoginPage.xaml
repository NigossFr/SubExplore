<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:SubExplore.ViewModels"
             x:Class="SubExplore.Views.Auth.LoginPage"
             Shell.NavBarIsVisible="False"
             BackgroundColor="{StaticResource Background}">

    <ContentPage.Resources>
        <Style x:Key="EntryStyle" TargetType="Entry">
            <Setter Property="HeightRequest" Value="50"/>
            <Setter Property="BackgroundColor" Value="White"/>
            <Setter Property="TextColor" Value="{StaticResource Primary}"/>
            <Setter Property="PlaceholderColor" Value="{StaticResource Gray400}"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="Margin" Value="0,5"/>
            <Setter Property="Padding" Value="15,0"/>
        </Style>

        <Style x:Key="ButtonStyle" TargetType="Button">
            <Setter Property="HeightRequest" Value="50"/>
            <Setter Property="CornerRadius" Value="25"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontAttributes" Value="Bold"/>
            <Setter Property="Margin" Value="0,10"/>
        </Style>
    </ContentPage.Resources>

    <ScrollView>
        <Grid RowDefinitions="Auto,*"
              Padding="20"
              RowSpacing="20">

            <!-- Logo et En-tête -->
            <VerticalStackLayout Grid.Row="0" 
                                Spacing="10" 
                                Margin="0,40,0,20">
                <Image Source="logo.png"
                       HeightRequest="100"
                       HorizontalOptions="Center"/>
                <Label Text="SubExplore"
                       TextColor="{StaticResource Primary}"
                       FontSize="32"
                       FontAttributes="Bold"
                       HorizontalOptions="Center"/>
                <Label Text="Connectez-vous pour découvrir les plus beaux spots"
                       TextColor="{StaticResource Gray600}"
                       FontSize="16"
                       HorizontalOptions="Center"/>
            </VerticalStackLayout>

            <!-- Formulaire de connexion -->
            <Frame Grid.Row="1"
                   BackgroundColor="White"
                   Margin="0,20"
                   Padding="20"
                   CornerRadius="15"
                   HasShadow="True">

                <VerticalStackLayout Spacing="15">
                    <!-- Message d'erreur -->
                    <Label Text="{Binding ErrorMessage}"
                           IsVisible="{Binding HasError}"
                           TextColor="{StaticResource Error}"
                           FontSize="14"
                           Margin="0,0,0,10"/>

                    <!-- Email -->
                    <Entry Style="{StaticResource EntryStyle}"
                           Text="{Binding LoginModel.Email}"
                           Placeholder="Email"
                           Keyboard="Email"
                           ReturnType="Next">
                        <Entry.Behaviors>
                            <EntryEmailValidationBehavior/>
                        </Entry.Behaviors>
                    </Entry>

                    <!-- Mot de passe -->
                    <Grid ColumnDefinitions="*,Auto">
                        <Entry Grid.Column="0"
                               Style="{StaticResource EntryStyle}"
                               Text="{Binding LoginModel.Password}"
                               Placeholder="Mot de passe"
                               IsPassword="{Binding IsPasswordHidden}"
                               ReturnType="Done"
                               ReturnCommand="{Binding LoginCommand}"/>
                        <ImageButton Grid.Column="1"
                                   Source="{Binding PasswordVisibilityIcon}"
                                   Command="{Binding TogglePasswordCommand}"
                                   HeightRequest="30"
                                   WidthRequest="30"
                                   Margin="10,0,0,0"
                                   Opacity="0.6"/>
                    </Grid>

                    <!-- Se souvenir de moi -->
                    <HorizontalStackLayout Spacing="10">
                        <CheckBox IsChecked="{Binding LoginModel.RememberMe}"
                                 Color="{StaticResource Primary}"/>
                        <Label Text="Se souvenir de moi"
                               VerticalTextAlignment="Center"
                               TextColor="{StaticResource Gray600}"/>
                    </HorizontalStackLayout>

                    <!-- Bouton de connexion -->
                    <Button Text="{Binding LoginButtonText}"
                            Style="{StaticResource ButtonStyle}"
                            BackgroundColor="{StaticResource Primary}"
                            TextColor="White"
                            Command="{Binding LoginCommand}"
                            IsEnabled="{Binding IsNotLoading}"/>

                    <!-- Mot de passe oublié -->
                    <Button Text="Mot de passe oublié ?"
                            Style="{StaticResource ButtonStyle}"
                            BackgroundColor="Transparent"
                            TextColor="{StaticResource Primary}"
                            Command="{Binding NavigateToForgotPasswordCommand}"/>

                    <BoxView HeightRequest="1"
                            Color="{StaticResource Gray200}"
                            Margin="0,10"/>

                    <!-- Inscription -->
                    <VerticalStackLayout Spacing="10">
                        <Label Text="Pas encore de compte ?"
                               HorizontalOptions="Center"
                               TextColor="{StaticResource Gray600}"/>
                        <Button Text="Créer un compte"
                                Style="{StaticResource ButtonStyle}"
                                BackgroundColor="{StaticResource Secondary}"
                                TextColor="White"
                                Command="{Binding NavigateToRegisterCommand}"/>
                    </VerticalStackLayout>

                    <!-- Connexion sociale -->
                    <VerticalStackLayout Spacing="10" 
                                       IsVisible="{Binding IsSocialLoginEnabled}">
                        <Label Text="Ou connectez-vous avec"
                               HorizontalOptions="Center"
                               TextColor="{StaticResource Gray600}"/>
                        <HorizontalStackLayout HorizontalOptions="Center" 
                                             Spacing="20">
                            <ImageButton Source="google_icon.png"
                                       HeightRequest="40"
                                       WidthRequest="40"
                                       Command="{Binding LoginWithProviderCommand}"
                                       CommandParameter="Google"/>
                            <ImageButton Source="facebook_icon.png"
                                       HeightRequest="40"
                                       WidthRequest="40"
                                       Command="{Binding LoginWithProviderCommand}"
                                       CommandParameter="Facebook"/>
                        </HorizontalStackLayout>
                    </VerticalStackLayout>
                </VerticalStackLayout>
            </Frame>
        </Grid>
    </ScrollView>

</ContentPage>